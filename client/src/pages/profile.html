<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile - TechHub Computer Components Store</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
  </head>
  <body class="bg-light pt-5">
    <!-- Header will be loaded dynamically from client/src/components/header.html -->
    <header id="header-container"></header>

    <main class="py-5">
      <div class="container">
        <h1 class="fw-bold mb-4">My Profile</h1>

        <div class="row g-4">
          <!-- Profile Sidebar -->
          <div class="col-lg-3">
            <!-- User Info Card -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
              <div class="card-body text-center p-4">
                <div class="mb-3">
                  <div
                    class="d-inline-flex bg-primary bg-opacity-10 rounded-circle p-3 mb-3"
                  >
                    <i class="bi bi-person-circle text-primary display-4"></i>
                  </div>
                  <h4 id="profile-fullname" class="mb-1">John Doe</h4>
                  <p class="text-muted mb-2" id="profile-email">
                    john.doe@example.com
                  </p>
                  <span class="badge bg-primary" id="profile-role"
                    >Customer</span
                  >
                </div>
                <hr />
                <div class="nav flex-column nav-pills">
                  <a
                    class="nav-link active d-flex align-items-center mb-2"
                    href="#profile"
                    data-bs-toggle="pill"
                    id="profile-tab"
                  >
                    <i class="bi bi-person-badge me-2"></i> Profile Information
                  </a>
                  <a
                    class="nav-link d-flex align-items-center mb-2"
                    href="#addresses"
                    data-bs-toggle="pill"
                    id="addresses-tab"
                  >
                    <i class="bi bi-geo-alt me-2"></i> My Addresses
                  </a>
                  <a
                    class="nav-link d-flex align-items-center mb-2"
                    href="#orders"
                    data-bs-toggle="pill"
                    id="orders-tab"
                  >
                    <i class="bi bi-box-seam me-2"></i> Order History
                  </a>
                  <a
                    class="nav-link d-flex align-items-center mb-2"
                    href="#password"
                    data-bs-toggle="pill"
                    id="password-tab"
                  >
                    <i class="bi bi-key me-2"></i> Change Password
                  </a>
                  <a
                    class="nav-link text-danger d-flex align-items-center"
                    href="#"
                    id="logout-button"
                  >
                    <i class="bi bi-box-arrow-right me-2"></i> Logout
                  </a>
                </div>
              </div>
            </div>

            <!-- Loyalty Points Card -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
              <div class="card-header bg-white py-3 border-0">
                <h5 class="mb-0 fw-bold">
                  <i class="bi bi-star-fill text-warning me-2"></i> Loyalty
                  Points
                </h5>
              </div>
              <div class="card-body text-center p-4">
                <div class="display-4 fw-bold mb-1" id="loyalty-points-value">
                  1,250
                </div>
                <p class="text-muted mb-3">Available Points</p>
                <div class="progress mb-3">
                  <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: 25%"
                    aria-valuenow="25"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
                <p class="small text-muted mb-0">Next reward at 5,000 points</p>
                <hr />
                <p class="small mb-0">
                  Use your points on your next purchase. 100 points = $1
                  discount.
                </p>
              </div>
            </div>
          </div>

          <!-- Main Content Area -->
          <div class="col-lg-9">
            <div class="card border-0 shadow-sm rounded-4">
              <div class="card-body p-4">
                <div class="tab-content">
                  <!-- Profile Information Tab -->
                  <div class="tab-pane fade show active" id="profile">
                    <h4 class="mb-4 fw-bold">Profile Information</h4>
                    <form id="update-profile-form">
                      <div class="row g-3">
                        <div class="col-md-6 mb-3">
                          <label for="update-fullname" class="form-label"
                            >Full Name</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="update-fullname"
                            name="fullName"
                            value="John Doe"
                            required
                          />
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="update-email" class="form-label"
                            >Email Address</label
                          >
                          <input
                            type="email"
                            class="form-control"
                            id="update-email"
                            name="email"
                            value="john.doe@example.com"
                            required
                          />
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="update-phone" class="form-label"
                            >Phone Number</label
                          >
                          <input
                            type="tel"
                            class="form-control"
                            id="update-phone"
                            name="phone"
                            value="+1 (555) 123-4567"
                          />
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="update-birthdate" class="form-label"
                            >Date of Birth</label
                          >
                          <input
                            type="date"
                            class="form-control"
                            id="update-birthdate"
                            name="birthdate"
                            value="1990-01-15"
                          />
                        </div>
                        <div class="col-12">
                          <div class="form-check mb-3">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="update-newsletter"
                              name="newsletter"
                              checked
                            />
                            <label
                              class="form-check-label"
                              for="update-newsletter"
                            >
                              Subscribe to newsletter for exclusive deals and
                              updates
                            </label>
                          </div>
                          <div class="form-check mb-3">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="update-sms"
                              name="smsNotifications"
                            />
                            <label class="form-check-label" for="update-sms">
                              Receive SMS notifications for order updates
                            </label>
                          </div>
                        </div>
                        <div class="col-12">
                          <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Update
                            Profile
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>

                  <!-- Addresses Tab -->
                  <div class="tab-pane fade" id="addresses">
                    <div
                      class="d-flex justify-content-between align-items-center mb-4"
                    >
                      <h4 class="mb-0 fw-bold">My Addresses</h4>
                      <button
                        class="btn btn-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#addAddressModal"
                      >
                        <i class="bi bi-plus-circle me-2"></i>Add New Address
                      </button>
                    </div>

                    <div id="address-list" class="row g-3">
                      <!-- Address Card -->
                      <div class="col-md-6">
                        <div class="card h-100 border">
                          <div
                            class="card-header bg-white d-flex align-items-center justify-content-between py-3"
                          >
                            <h5 class="card-title mb-0">Home</h5>
                            <span class="badge bg-primary">Default</span>
                          </div>
                          <div class="card-body">
                            <p class="mb-1"><strong>John Doe</strong></p>
                            <p class="mb-1">123 Main Street, Apt 4B</p>
                            <p class="mb-1">New York, NY 10001</p>
                            <p class="mb-1">United States</p>
                            <p class="mb-3">Phone: +1 (555) 123-4567</p>
                            <div class="d-flex justify-content-end gap-2">
                              <button
                                class="btn btn-sm btn-outline-primary edit-address"
                                data-address-id="addr1"
                              >
                                <i class="bi bi-pencil"></i>
                              </button>
                              <button
                                class="btn btn-sm btn-outline-danger delete-address"
                                data-address-id="addr1"
                              >
                                <i class="bi bi-trash"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Address Card -->
                      <div class="col-md-6">
                        <div class="card h-100 border">
                          <div
                            class="card-header bg-white d-flex align-items-center justify-content-between py-3"
                          >
                            <h5 class="card-title mb-0">Work</h5>
                          </div>
                          <div class="card-body">
                            <p class="mb-1"><strong>John Doe</strong></p>
                            <p class="mb-1">456 Business Ave, Suite 200</p>
                            <p class="mb-1">New York, NY 10022</p>
                            <p class="mb-1">United States</p>
                            <p class="mb-3">Phone: +1 (555) 987-6543</p>
                            <div class="d-flex justify-content-end gap-2">
                              <button
                                class="btn btn-sm btn-outline-secondary set-default-address"
                                data-address-id="addr2"
                              >
                                Set as Default
                              </button>
                              <button
                                class="btn btn-sm btn-outline-primary edit-address"
                                data-address-id="addr2"
                              >
                                <i class="bi bi-pencil"></i>
                              </button>
                              <button
                                class="btn btn-sm btn-outline-danger delete-address"
                                data-address-id="addr2"
                              >
                                <i class="bi bi-trash"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Order History Tab -->
                  <div class="tab-pane fade" id="orders">
                    <h4 class="mb-4 fw-bold">Order History</h4>

                    <div class="card mb-3 border-0 shadow-sm">
                      <div
                        class="card-header bg-white d-flex justify-content-between align-items-center py-3"
                      >
                        <div>
                          <h5 class="mb-1">Order #TH-123456</h5>
                          <span class="text-muted small"
                            >Placed on April 15, 2025</span
                          >
                        </div>
                        <span class="badge bg-success">Delivered</span>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-7">
                            <div class="d-flex mb-2">
                              <img
                                src="/api/placeholder/80/80"
                                alt="Product"
                                class="img-thumbnail me-3"
                                style="
                                  width: 60px;
                                  height: 60px;
                                  object-fit: contain;
                                "
                              />
                              <div>
                                <h6 class="mb-0">AMD Ryzen 9 5900X</h6>
                                <p class="text-muted mb-0 small">$499.99 x 1</p>
                              </div>
                            </div>
                            <div class="d-flex">
                              <img
                                src="/api/placeholder/80/80"
                                alt="Product"
                                class="img-thumbnail me-3"
                                style="
                                  width: 60px;
                                  height: 60px;
                                  object-fit: contain;
                                "
                              />
                              <div>
                                <h6 class="mb-0">NVIDIA GeForce RTX 3080</h6>
                                <p class="text-muted mb-0 small">$699.99 x 1</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-5 mt-3 mt-md-0">
                            <div class="d-flex justify-content-between mb-2">
                              <span>Subtotal:</span>
                              <span>$1,199.98</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Shipping:</span>
                              <span>FREE</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Total:</span>
                              <span class="fw-bold">$1,199.98</span>
                            </div>
                            <div class="d-flex justify-content-end mt-3">
                              <a
                                href="#"
                                class="btn btn-sm btn-outline-primary me-2"
                                >Track Order</a
                              >
                              <a href="#" class="btn btn-sm btn-primary"
                                >View Details</a
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card mb-3 border-0 shadow-sm">
                      <div
                        class="card-header bg-white d-flex justify-content-between align-items-center py-3"
                      >
                        <div>
                          <h5 class="mb-1">Order #TH-123455</h5>
                          <span class="text-muted small"
                            >Placed on March 22, 2025</span
                          >
                        </div>
                        <span class="badge bg-warning text-dark"
                          >Processing</span
                        >
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-7">
                            <div class="d-flex mb-2">
                              <img
                                src="/api/placeholder/80/80"
                                alt="Product"
                                class="img-thumbnail me-3"
                                style="
                                  width: 60px;
                                  height: 60px;
                                  object-fit: contain;
                                "
                              />
                              <div>
                                <h6 class="mb-0">Samsung 970 EVO Plus 1TB</h6>
                                <p class="text-muted mb-0 small">$149.99 x 2</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-5 mt-3 mt-md-0">
                            <div class="d-flex justify-content-between mb-2">
                              <span>Subtotal:</span>
                              <span>$299.98</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Shipping:</span>
                              <span>FREE</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Total:</span>
                              <span class="fw-bold">$299.98</span>
                            </div>
                            <div class="d-flex justify-content-end mt-3">
                              <a
                                href="#"
                                class="btn btn-sm btn-outline-primary me-2"
                                >Track Order</a
                              >
                              <a href="#" class="btn btn-sm btn-primary"
                                >View Details</a
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card border-0 shadow-sm">
                      <div
                        class="card-header bg-white d-flex justify-content-between align-items-center py-3"
                      >
                        <div>
                          <h5 class="mb-1">Order #TH-123454</h5>
                          <span class="text-muted small"
                            >Placed on February 10, 2025</span
                          >
                        </div>
                        <span class="badge bg-secondary">Completed</span>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-7">
                            <div class="d-flex">
                              <img
                                src="/api/placeholder/80/80"
                                alt="Product"
                                class="img-thumbnail me-3"
                                style="
                                  width: 60px;
                                  height: 60px;
                                  object-fit: contain;
                                "
                              />
                              <div>
                                <h6 class="mb-0">
                                  Corsair RM750x Power Supply
                                </h6>
                                <p class="text-muted mb-0 small">$129.99 x 1</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-5 mt-3 mt-md-0">
                            <div class="d-flex justify-content-between mb-2">
                              <span>Subtotal:</span>
                              <span>$129.99</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Shipping:</span>
                              <span>$9.99</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                              <span>Total:</span>
                              <span class="fw-bold">$139.98</span>
                            </div>
                            <div class="d-flex justify-content-end mt-3">
                              <a
                                href="#"
                                class="btn btn-sm btn-outline-primary me-2"
                                >Track Order</a
                              >
                              <a href="#" class="btn btn-sm btn-primary"
                                >View Details</a
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Change Password Tab -->
                  <div class="tab-pane fade" id="password">
                    <h4 class="mb-4 fw-bold">Change Password</h4>
                    <form id="update-password-form">
                      <div class="mb-3">
                        <label for="current-password" class="form-label"
                          >Current Password</label
                        >
                        <input
                          type="password"
                          class="form-control"
                          id="current-password"
                          name="currentPassword"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="new-password" class="form-label"
                          >New Password</label
                        >
                        <input
                          type="password"
                          class="form-control"
                          id="new-password"
                          name="newPassword"
                          required
                        />
                        <div class="form-text">
                          Password must be at least 8 characters long and
                          include uppercase letters, lowercase letters, and
                          numbers.
                        </div>
                      </div>
                      <div class="mb-3">
                        <label for="confirm-password" class="form-label"
                          >Confirm New Password</label
                        >
                        <input
                          type="password"
                          class="form-control"
                          id="confirm-password"
                          name="confirmPassword"
                          required
                        />
                      </div>
                      <button type="submit" class="btn btn-primary">
                        <i class="bi bi-shield-lock me-2"></i>Update Password
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Address Modal -->
      <div
        class="modal fade"
        id="addAddressModal"
        tabindex="-1"
        aria-labelledby="addAddressModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title fw-bold" id="addAddressModalLabel">
                Add New Address
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="add-address-form">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="address-name" class="form-label"
                      >Address Name</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-name"
                      name="addressName"
                      placeholder="Home, Work, etc."
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-fullname" class="form-label"
                      >Full Name</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-fullname"
                      name="fullName"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-phone" class="form-label"
                      >Phone Number</label
                    >
                    <input
                      type="tel"
                      class="form-control"
                      id="address-phone"
                      name="phoneNumber"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-email" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="address-email"
                      name="email"
                    />
                  </div>
                  <div class="col-12">
                    <label for="address-line1" class="form-label"
                      >Address Line 1</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-line1"
                      name="addressLine1"
                      placeholder="Street address, P.O. box, company name"
                      required
                    />
                  </div>
                  <div class="col-12">
                    <label for="address-line2" class="form-label"
                      >Address Line 2</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-line2"
                      name="addressLine2"
                      placeholder="Apartment, suite, unit, building, floor, etc."
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-city" class="form-label">City</label>
                    <input
                      type="text"
                      class="form-control"
                      id="address-city"
                      name="city"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-state" class="form-label"
                      >State/Province</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-state"
                      name="state"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-postal-code" class="form-label"
                      >Postal Code</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="address-postal-code"
                      name="postalCode"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="address-country" class="form-label"
                      >Country</label
                    >
                    <select
                      class="form-select"
                      id="address-country"
                      name="country"
                      required
                    >
                      <option value="">Select Country</option>
                      <option value="VN" selected>Vietnam</option>
                      <option value="US">United States</option>
                      <option value="CA">Canada</option>
                      <option value="UK">United Kingdom</option>
                      <option value="AU">Australia</option>
                      <option value="SG">Singapore</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="address-default"
                        name="isDefault"
                      />
                      <label class="form-check-label" for="address-default">
                        Set as default address
                      </label>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="save-address-btn"
              >
                Save Address
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer will be loaded dynamically from client/src/components/footer.html -->
    <footer id="footer-container"></footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 for better alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Load header and footer components
        loadComponents();

        // Setup profile page functionality
        setupProfilePage();

        // Check for hash in URL to activate correct tab
        activateTabFromHash();
      });

      // Load header and footer components
      function loadComponents() {
        // Load header
        fetch("/client/src/components/header.html")
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `Failed to load header: ${response.status} ${response.statusText}`
              );
            }
            return response.text();
          })
          .then((html) => {
            document.getElementById("header-container").innerHTML = html;
          })
          .catch((error) => {
            console.error("Error loading header:", error);
            document.getElementById("header-container").innerHTML = `
            <div class="alert alert-danger m-3" role="alert">
              <h4 class="alert-heading">Error Loading Header</h4>
              <p>${error.message}</p>
              <hr>
              <p class="mb-0">Please check the path to your header component.</p>
            </div>
          `;
          });

        // Load footer
        fetch("/client/src/components/footer.html")
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `Failed to load footer: ${response.status} ${response.statusText}`
              );
            }
            return response.text();
          })
          .then((html) => {
            document.getElementById("footer-container").innerHTML = html;
          })
          .catch((error) => {
            console.error("Error loading footer:", error);
            document.getElementById("footer-container").innerHTML = `
            <div class="alert alert-danger m-3" role="alert">
              <h4 class="alert-heading">Error Loading Footer</h4>
              <p>${error.message}</p>
              <hr>
              <p class="mb-0">Please check the path to your footer component.</p>
            </div>
          `;
          });
      }

      // Activate tab based on URL hash
      function activateTabFromHash() {
        const hash = window.location.hash;
        if (hash) {
          const tabId = hash.substring(1); // Remove the # character
          const tabElement = document.getElementById(`${tabId}-tab`);

          if (tabElement) {
            tabElement.click();
          }
        }
      }

      // Setup profile page functionality
      function setupProfilePage() {
        // Set up profile update form
        setupProfileForm();

        // Set up password update form
        setupPasswordForm();

        // Set up address management
        setupAddressManagement();

        // Set up logout button
        setupLogout();
      }

      // Set up profile update form
      function setupProfileForm() {
        const profileForm = document.getElementById("update-profile-form");
        if (!profileForm) return;

        profileForm.addEventListener("submit", function (e) {
          e.preventDefault();

          // Show loading button
          const submitBtn = this.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;
          submitBtn.disabled = true;
          submitBtn.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Updating...';

          // Get form data
          const formData = new FormData(this);
          const profileData = {
            fullName: formData.get("fullName"),
            email: formData.get("email"),
            phone: formData.get("phone"),
            birthdate: formData.get("birthdate"),
            newsletter: formData.get("newsletter") === "on",
            smsNotifications: formData.get("smsNotifications") === "on",
          };

          // Simulate API call
          setTimeout(() => {
            // Reset button
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;

            // Reset form
            passwordForm.reset();

            // Show success message
            Swal.fire({
              title: "Password Updated!",
              text: "Your password has been updated successfully.",
              icon: "success",
              confirmButtonText: "OK",
            });
          }, 1000);
        });
      }

      // Set up address management
      function setupAddressManagement() {
        // Add new address
        setupAddNewAddress();

        // Edit address
        setupEditAddress();

        // Delete address
        setupDeleteAddress();

        // Set default address
        setupDefaultAddress();
      }

      // Set up add new address functionality
      function setupAddNewAddress() {
        const saveAddressBtn = document.getElementById("save-address-btn");
        const addAddressForm = document.getElementById("add-address-form");

        if (!saveAddressBtn || !addAddressForm) return;

        saveAddressBtn.addEventListener("click", function () {
          // Validate form
          const requireInputs = addAddressForm.querySelectorAll("[required]");
          let isValid = true;

          requireInputs.forEach((input) => {
            if (!input.value.trim()) {
              input.classList.add("is-invalid");
              isValid = false;
            } else {
              input.classList.remove("is-invalid");
            }
          });

          if (!isValid) {
            Swal.fire({
              title: "Error",
              text: "Please fill in all required fields.",
              icon: "error",
              confirmButtonText: "OK",
            });
            return;
          }

          // Show loading button
          const originalText = saveAddressBtn.innerHTML;
          saveAddressBtn.disabled = true;
          saveAddressBtn.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Saving...';

          // Get form data
          const formData = new FormData(addAddressForm);
          const addressData = {
            name: formData.get("addressName"),
            fullName: formData.get("fullName"),
            phoneNumber: formData.get("phoneNumber"),
            email: formData.get("email"),
            addressLine1: formData.get("addressLine1"),
            addressLine2: formData.get("addressLine2") || "",
            city: formData.get("city"),
            state: formData.get("state"),
            postalCode: formData.get("postalCode"),
            country: formData.get("country"),
            isDefault: formData.get("isDefault") === "on",
          };

          // Simulate API call
          setTimeout(() => {
            // Reset button
            saveAddressBtn.disabled = false;
            saveAddressBtn.innerHTML = originalText;

            // Add new address to the list
            addAddressToUI(addressData);

            // Close modal
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("addAddressModal")
            );
            modal.hide();

            // Reset form
            addAddressForm.reset();

            // Show success message
            Swal.fire({
              title: "Address Added!",
              text: "Your new address has been added successfully.",
              icon: "success",
              confirmButtonText: "OK",
            });
          }, 1000);
        });
      }

      // Add new address to UI
      function addAddressToUI(addressData) {
        const addressList = document.getElementById("address-list");
        if (!addressList) return;

        // Create address ID
        const addressId = `addr-${Date.now()}`;

        // Create address element
        const addressElement = document.createElement("div");
        addressElement.className = "col-md-6";
        addressElement.innerHTML = `
        <div class="card h-100 border">
          <div class="card-header bg-white d-flex align-items-center justify-content-between py-3">
            <h5 class="card-title mb-0">${addressData.name}</h5>
            ${
              addressData.isDefault
                ? '<span class="badge bg-primary">Default</span>'
                : ""
            }
          </div>
          <div class="card-body">
            <p class="mb-1"><strong>${addressData.fullName}</strong></p>
            <p class="mb-1">${addressData.addressLine1}</p>
            ${
              addressData.addressLine2
                ? `<p class="mb-1">${addressData.addressLine2}</p>`
                : ""
            }
            <p class="mb-1">${addressData.city}, ${addressData.state} ${
          addressData.postalCode
        }</p>
            <p class="mb-1">${getCountryName(addressData.country)}</p>
            <p class="mb-3">Phone: ${addressData.phoneNumber}</p>
            <div class="d-flex justify-content-end gap-2">
              ${
                !addressData.isDefault
                  ? `<button class="btn btn-sm btn-outline-secondary set-default-address" data-address-id="${addressId}">
                  Set as Default
                </button>`
                  : ""
              }
              <button class="btn btn-sm btn-outline-primary edit-address" data-address-id="${addressId}">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger delete-address" data-address-id="${addressId}">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      `;

        // Add to list
        addressList.appendChild(addressElement);
      }

      // Get country name from code
      function getCountryName(countryCode) {
        const countries = {
          VN: "Vietnam",
          US: "United States",
          CA: "Canada",
          UK: "United Kingdom",
          AU: "Australia",
          SG: "Singapore",
        };

        return countries[countryCode] || countryCode;
      }

      // Set up edit address functionality
      function setupEditAddress() {
        const addressList = document.getElementById("address-list");
        if (!addressList) return;

        addressList.addEventListener("click", function (e) {
          if (
            e.target.classList.contains("edit-address") ||
            e.target.closest(".edit-address")
          ) {
            const button = e.target.classList.contains("edit-address")
              ? e.target
              : e.target.closest(".edit-address");
            const addressId = button.getAttribute("data-address-id");
            const addressCard = button.closest(".card");

            // In a real app, you would fetch address details from API
            // For this demo, we'll extract data from the card
            const addressName =
              addressCard.querySelector(".card-title").textContent;
            const fullName = addressCard.querySelector("strong").textContent;

            // Show edit address modal (reusing add address modal for simplicity)
            const modal = new bootstrap.Modal(
              document.getElementById("addAddressModal")
            );
            modal.show();

            // Update modal title
            document.getElementById("addAddressModalLabel").textContent =
              "Edit Address";

            // Prefill form with address data
            document.getElementById("address-name").value = addressName;
            document.getElementById("address-fullname").value = fullName;

            // In a real app, you would prefill all fields
            // For this demo, we'll just do these two

            // Update save button to handle edit
            const saveBtn = document.getElementById("save-address-btn");
            saveBtn.setAttribute("data-edit-mode", "true");
            saveBtn.setAttribute("data-address-id", addressId);
          }
        });
      }

      // Set up delete address functionality
      function setupDeleteAddress() {
        const addressList = document.getElementById("address-list");
        if (!addressList) return;

        addressList.addEventListener("click", function (e) {
          if (
            e.target.classList.contains("delete-address") ||
            e.target.closest(".delete-address")
          ) {
            const button = e.target.classList.contains("delete-address")
              ? e.target
              : e.target.closest(".delete-address");
            const addressId = button.getAttribute("data-address-id");
            const addressCard = button.closest(".col-md-6");

            // Confirm deletion
            Swal.fire({
              title: "Delete Address?",
              text: "Are you sure you want to delete this address?",
              icon: "warning",
              showCancelButton: true,
              confirmButtonText: "Yes, delete it",
              cancelButtonText: "Cancel",
            }).then((result) => {
              if (result.isConfirmed) {
                // Simulate API call
                // In a real app, you would call API to delete address

                // Remove address from UI with animation
                addressCard.style.transition = "opacity 0.3s ease";
                addressCard.style.opacity = "0";

                setTimeout(() => {
                  addressCard.remove();

                  // Show success message
                  Swal.fire({
                    title: "Deleted!",
                    text: "Address has been deleted successfully.",
                    icon: "success",
                    confirmButtonText: "OK",
                  });
                }, 300);
              }
            });
          }
        });
      }

      // Set up default address functionality
      function setupDefaultAddress() {
        const addressList = document.getElementById("address-list");
        if (!addressList) return;

        addressList.addEventListener("click", function (e) {
          if (
            e.target.classList.contains("set-default-address") ||
            e.target.closest(".set-default-address")
          ) {
            const button = e.target.classList.contains("set-default-address")
              ? e.target
              : e.target.closest(".set-default-address");
            const addressId = button.getAttribute("data-address-id");

            // Show loading state
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML =
              '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';

            // Simulate API call
            setTimeout(() => {
              // Remove default badge from all addresses
              const defaultBadges =
                addressList.querySelectorAll(".badge.bg-primary");
              defaultBadges.forEach((badge) => badge.remove());

              // Remove "Set as Default" button from all addresses
              const defaultButtons = addressList.querySelectorAll(
                ".set-default-address"
              );
              defaultButtons.forEach((btn) => {
                const btnContainer = btn.parentElement;
                btnContainer.removeChild(btn);
              });

              // Add default badge to this address
              const addressHeader = button
                .closest(".card")
                .querySelector(".card-header");
              const badgeSpan = document.createElement("span");
              badgeSpan.className = "badge bg-primary";
              badgeSpan.textContent = "Default";
              addressHeader.appendChild(badgeSpan);

              // Remove this button
              const btnContainer = button.parentElement;
              btnContainer.removeChild(button);

              // Add "Set as Default" button to other addresses
              const addressCards = addressList.querySelectorAll(".card");
              addressCards.forEach((card) => {
                if (!card.querySelector(".badge.bg-primary")) {
                  const cardButtons = card.querySelector(
                    ".d-flex.justify-content-end"
                  );
                  const newDefaultBtn = document.createElement("button");
                  newDefaultBtn.className =
                    "btn btn-sm btn-outline-secondary set-default-address";
                  newDefaultBtn.setAttribute(
                    "data-address-id",
                    "addr-" + Math.floor(Math.random() * 1000)
                  );
                  newDefaultBtn.textContent = "Set as Default";
                  cardButtons.prepend(newDefaultBtn);
                }
              });

              // Show success message
              Swal.fire({
                title: "Default Address Updated",
                text: "Your default address has been updated.",
                icon: "success",
                confirmButtonText: "OK",
              });
            }, 800);
          }
        });
      }

      // Set up logout button
      function setupLogout() {
        const logoutButton = document.getElementById("logout-button");
        if (!logoutButton) return;

        logoutButton.addEventListener("click", function (e) {
          e.preventDefault();

          // Confirm logout
          Swal.fire({
            title: "Logout",
            text: "Are you sure you want to logout?",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Yes, logout",
            cancelButtonText: "Cancel",
          }).then((result) => {
            if (result.isConfirmed) {
              // Simulate logout
              // In a real app, you would call API to logout and clear local storage

              // Redirect to home page
              window.location.href = "index.html";
            }
          });
        });
      }
    </script>
  </body>
</html>
<!-- End of HTML Document -->

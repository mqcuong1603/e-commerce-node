<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - TechHub Computer Components Store</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body class="bg-light pt-5">
    <!-- Header will be loaded dynamically from components/header.html -->
    <header id="header-container"></header>

    <main>
      <section class="py-5">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-8">
              <div class="bg-white rounded-4 shadow-sm p-4 p-md-5 mb-5">
                <!-- Form Header -->
                <div class="text-center mb-4">
                  <div
                    class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded-circle mb-3"
                    style="width: 80px; height: 80px"
                  >
                    <i class="bi bi-person-plus fs-1 text-primary"></i>
                  </div>
                  <h1 class="fw-bold mb-2">Create Your Account</h1>
                  <p class="text-muted">
                    Fill in your information below to get started with TechHub
                  </p>
                </div>

                <!-- Registration Form -->
                <form id="register-form" class="needs-validation" novalidate>
                  <!-- Account Information Section -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div
                      class="card-header bg-primary bg-opacity-10 border-0 py-3"
                    >
                      <div class="d-flex align-items-center">
                        <i class="bi bi-person-vcard me-2 text-primary"></i>
                        <h5 class="mb-0 fw-semibold">Account Information</h5>
                      </div>
                    </div>
                    <div class="card-body p-4">
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label
                            for="register-fullname"
                            class="form-label fw-medium"
                            >Full Name</label
                          >
                          <div class="input-group">
                            <span class="input-group-text bg-light"
                              ><i class="bi bi-person"></i
                            ></span>
                            <input
                              type="text"
                              class="form-control"
                              id="register-fullname"
                              name="fullName"
                              placeholder="Enter your full name"
                              required
                            />
                          </div>
                          <div class="invalid-feedback">
                            Please enter your full name.
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label
                            for="register-email"
                            class="form-label fw-medium"
                            >Email Address</label
                          >
                          <div class="input-group">
                            <span class="input-group-text bg-light"
                              ><i class="bi bi-envelope"></i
                            ></span>
                            <input
                              type="email"
                              class="form-control"
                              id="register-email"
                              name="email"
                              placeholder="you@example.com"
                              required
                            />
                          </div>
                          <div class="invalid-feedback">
                            Please enter a valid email address.
                          </div>
                          <div class="form-text mt-1">
                            <i
                              class="bi bi-info-circle-fill text-primary me-1"
                            ></i>
                            A temporary password will be sent to this email.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Shipping Address Section -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div
                      class="card-header bg-primary bg-opacity-10 border-0 py-3"
                    >
                      <div class="d-flex align-items-center">
                        <i class="bi bi-geo-alt me-2 text-primary"></i>
                        <h5 class="mb-0 fw-semibold">Shipping Address</h5>
                      </div>
                    </div>
                    <div class="card-body p-4">
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label
                            for="register-address-fullname"
                            class="form-label fw-medium"
                            >Full Name for Shipping</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="register-address-fullname"
                            name="address.fullName"
                            placeholder="Name to appear on deliveries"
                          />
                          <div class="form-text">
                            <i
                              class="bi bi-info-circle-fill text-primary me-1"
                            ></i>
                            Leave blank to use account name.
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label
                            for="register-phone"
                            class="form-label fw-medium"
                            >Phone Number</label
                          >
                          <div class="input-group">
                            <span class="input-group-text bg-light"
                              ><i class="bi bi-telephone"></i
                            ></span>
                            <input
                              type="tel"
                              class="form-control"
                              id="register-phone"
                              name="address.phoneNumber"
                              placeholder="For delivery communications"
                              required
                            />
                          </div>
                          <div class="invalid-feedback">
                            Please enter a valid phone number.
                          </div>
                        </div>

                        <div class="col-12">
                          <label
                            for="register-address-line1"
                            class="form-label fw-medium"
                            >Address Line 1</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="register-address-line1"
                            name="address.addressLine1"
                            placeholder="Street address, P.O. box, company name"
                            required
                          />
                          <div class="invalid-feedback">
                            Please enter your street address.
                          </div>
                        </div>

                        <div class="col-12">
                          <label
                            for="register-address-line2"
                            class="form-label fw-medium"
                          >
                            Address Line 2
                            <span class="text-muted">(Optional)</span>
                          </label>
                          <input
                            type="text"
                            class="form-control"
                            id="register-address-line2"
                            name="address.addressLine2"
                            placeholder="Apartment, suite, unit, building, floor, etc."
                          />
                        </div>

                        <div class="col-md-5">
                          <label
                            for="register-country"
                            class="form-label fw-medium"
                            >Country</label
                          >
                          <select
                            class="form-select"
                            id="register-country"
                            name="address.country"
                            required
                          >
                            <option value="">Select a country</option>
                            <option value="VN" selected>Vietnam</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                            <option value="AU">Australia</option>
                            <option value="SG">Singapore</option>
                            <option value="JP">Japan</option>
                          </select>
                          <div class="invalid-feedback">
                            Please select a country.
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label
                            for="register-city"
                            class="form-label fw-medium"
                            >City</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="register-city"
                            name="address.city"
                            required
                          />
                          <div class="invalid-feedback">
                            Please enter your city.
                          </div>
                        </div>

                        <div class="col-md-3">
                          <label
                            for="register-postal-code"
                            class="form-label fw-medium"
                            >Postal Code</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="register-postal-code"
                            name="address.postalCode"
                            required
                          />
                          <div class="invalid-feedback">
                            Please enter your postal code.
                          </div>
                        </div>

                        <div class="col-12">
                          <label
                            for="register-state"
                            class="form-label fw-medium"
                            >State/Province</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="register-state"
                            name="address.state"
                            required
                          />
                          <div class="invalid-feedback">
                            Please enter your state or province.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Terms and Preferences Section -->
                  <div class="card border-0 shadow-sm mb-4">
                    <div
                      class="card-header bg-primary bg-opacity-10 border-0 py-3"
                    >
                      <div class="d-flex align-items-center">
                        <i class="bi bi-shield-check me-2 text-primary"></i>
                        <h5 class="mb-0 fw-semibold">Terms & Preferences</h5>
                      </div>
                    </div>
                    <div class="card-body p-4">
                      <div class="form-check mb-3">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="register-terms"
                          required
                        />
                        <label class="form-check-label" for="register-terms">
                          I agree to the
                          <a href="#" class="text-decoration-none fw-semibold"
                            >Terms and Conditions</a
                          >
                          and
                          <a href="#" class="text-decoration-none fw-semibold"
                            >Privacy Policy</a
                          >
                        </label>
                        <div class="invalid-feedback">
                          You must agree to the terms and conditions to proceed.
                        </div>
                      </div>

                      <div class="form-check mb-3">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="register-newsletter"
                        />
                        <label
                          class="form-check-label"
                          for="register-newsletter"
                        >
                          <i class="bi bi-envelope-paper text-success me-1"></i>
                          Subscribe to our newsletter for exclusive deals and
                          updates
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Submit Button -->
                  <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                      <i class="bi bi-person-plus-fill me-2"></i>Create Account
                    </button>
                  </div>
                </form>

                <!-- Social Login Options -->
                <div class="position-relative my-4">
                  <hr />
                  <p
                    class="small text-muted position-absolute top-50 start-50 translate-middle bg-white px-2"
                  >
                    OR CONTINUE WITH
                  </p>
                </div>

                <div class="row g-3">
                  <div class="col-md-6">
                    <button
                      id="google-signup"
                      class="btn btn-danger w-100 d-flex align-items-center justify-content-center gap-2"
                    >
                      <i class="bi bi-google"></i> Google
                    </button>
                  </div>
                  <div class="col-md-6">
                    <button
                      id="facebook-signup"
                      class="btn btn-primary w-100 d-flex align-items-center justify-content-center gap-2"
                    >
                      <i class="bi bi-facebook"></i> Facebook
                    </button>
                  </div>
                </div>

                <!-- Login Link -->
                <div class="text-center mt-4">
                  <p class="mb-0">
                    Already have an account?
                    <a
                      href="login.html"
                      class="text-decoration-none fw-semibold"
                      >Log in here</a
                    >
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer will be loaded dynamically from components/footer.html -->
    <footer id="footer-container"></footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 for better alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js"></script>

    <script>
      // Load header and footer components
      document.addEventListener("DOMContentLoaded", function () {
        // Load header
        fetch("/client/src/components/header.html")
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `Failed to load header: ${response.status} ${response.statusText}`
              );
            }
            return response.text();
          })
          .then((html) => {
            document.getElementById("header-container").innerHTML = html;

            // After loading header, highlight the current page in the navigation
            setTimeout(() => {
              const registerLinks = document.querySelectorAll(
                'a[href="register.html"]'
              );
              registerLinks.forEach((link) => {
                if (link.classList.contains("dropdown-item")) {
                  link.classList.add("active");
                }

                // If parent is a dropdown, mark it as active too
                const dropdownToggle = link
                  .closest(".dropdown")
                  ?.querySelector(".dropdown-toggle");
                if (dropdownToggle) {
                  dropdownToggle.classList.add("active");
                }
              });
            }, 100);
          })
          .catch((error) => {
            console.error("Error loading header:", error);
            document.getElementById("header-container").innerHTML = `
            <div class="alert alert-danger" role="alert">
              <h4 class="alert-heading">Error Loading Header</h4>
              <p>${error.message}</p>
              <hr>
              <p class="mb-0">Please check the path to your header component (/client/src/components/header.html).</p>
            </div>
          `;
          });

        // Load footer - using the same path structure as the header
        fetch("/client/src/components/footer.html")
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `Failed to load footer: ${response.status} ${response.statusText}`
              );
            }
            return response.text();
          })
          .then((html) => {
            document.getElementById("footer-container").innerHTML = html;
          })
          .catch((error) => {
            console.error("Error loading footer:", error);
            document.getElementById("footer-container").innerHTML = `
            <div class="alert alert-danger" role="alert">
              <h4 class="alert-heading">Error Loading Footer</h4>
              <p>${error.message}</p>
              <hr>
              <p class="mb-0">Please check the path to your footer component (/client/src/components/footer.html).</p>
            </div>
          `;
          });

        // Auto-fill address name from account name if left empty
        const fullNameField = document.getElementById("register-fullname");
        const addressNameField = document.getElementById(
          "register-address-fullname"
        );

        if (fullNameField && addressNameField) {
          fullNameField.addEventListener("input", function () {
            if (!addressNameField.value) {
              addressNameField.value = this.value;
            }
          });
        }

        // Form validation
        const forms = document.querySelectorAll(".needs-validation");

        Array.from(forms).forEach((form) => {
          form.addEventListener(
            "submit",
            (event) => {
              if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();

                // Find the first invalid field and scroll to it
                const invalidField = form.querySelector(":invalid");
                if (invalidField) {
                  invalidField.focus();
                  // Scroll to the invalidField's parent card
                  const card = invalidField.closest(".card");
                  if (card) {
                    card.scrollIntoView({ behavior: "smooth", block: "start" });
                  }
                }
              } else {
                // Form is valid, show loading state
                event.preventDefault();
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML =
                  '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Creating account...';

                // Get form data
                const formData = new FormData(form);
                const userData = {
                  fullName: formData.get("fullName"),
                  email: formData.get("email"),
                  address: {
                    fullName:
                      formData.get("address.fullName") ||
                      formData.get("fullName"),
                    phoneNumber: formData.get("address.phoneNumber"),
                    addressLine1: formData.get("address.addressLine1"),
                    addressLine2: formData.get("address.addressLine2") || "",
                    city: formData.get("address.city"),
                    state: formData.get("address.state"),
                    postalCode: formData.get("address.postalCode"),
                    country: formData.get("address.country"),
                  },
                  subscribeNewsletter: document.getElementById(
                    "register-newsletter"
                  ).checked,
                };

                // Simulate API call (replace with actual API call in production)
                setTimeout(() => {
                  // Reset form and button state
                  submitBtn.disabled = false;
                  submitBtn.innerHTML = originalText;
                  form.reset();
                  form.classList.remove("was-validated");

                  // Show success message
                  Swal.fire({
                    title: "Registration Successful!",
                    text: "Your account has been created! A temporary password has been sent to your email address. Please check your inbox and use it to log in.",
                    icon: "success",
                    confirmButtonText: "Continue to Login",
                  }).then(() => {
                    // Redirect to login page
                    window.location.href = "login.html";
                  });
                }, 1500);
              }

              form.classList.add("was-validated");
            },
            false
          );
        });

        // Phone number validation with visual feedback
        const phoneField = document.getElementById("register-phone");
        if (phoneField) {
          phoneField.addEventListener("input", function () {
            const phonePattern =
              /^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/;
            if (this.value && phonePattern.test(this.value)) {
              this.classList.add("is-valid");
              this.classList.remove("is-invalid");
              this.setCustomValidity("");
            } else if (this.value) {
              this.classList.add("is-invalid");
              this.classList.remove("is-valid");
              this.setCustomValidity("Please enter a valid phone number");
            } else {
              this.classList.remove("is-valid", "is-invalid");
            }
          });
        }

        // Email validation with visual feedback
        const emailField = document.getElementById("register-email");
        if (emailField) {
          emailField.addEventListener("input", function () {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (this.value && emailPattern.test(this.value)) {
              this.classList.add("is-valid");
              this.classList.remove("is-invalid");
              this.setCustomValidity("");
            } else if (this.value) {
              this.classList.add("is-invalid");
              this.classList.remove("is-valid");
              this.setCustomValidity("Please enter a valid email address");
            } else {
              this.classList.remove("is-valid", "is-invalid");
            }
          });
        }

        // Implement a country-state relationship
        const countrySelect = document.getElementById("register-country");
        const stateInput = document.getElementById("register-state");
        if (countrySelect && stateInput) {
          countrySelect.addEventListener("change", function () {
            if (this.value === "US") {
              stateInput.setAttribute(
                "placeholder",
                "e.g. California, New York"
              );
            } else if (this.value === "CA") {
              stateInput.setAttribute("placeholder", "e.g. Ontario, Quebec");
            } else if (this.value === "UK") {
              stateInput.setAttribute("placeholder", "e.g. England, Scotland");
            } else if (this.value === "VN") {
              stateInput.setAttribute("placeholder", "e.g. Ho Chi Minh, Hanoi");
            } else {
              stateInput.setAttribute("placeholder", "");
            }
          });

          // Trigger the change event to set initial placeholder
          const event = new Event("change");
          countrySelect.dispatchEvent(event);
        }

        // Social login buttons
        const googleSignupBtn = document.getElementById("google-signup");
        if (googleSignupBtn) {
          googleSignupBtn.addEventListener("click", function () {
            // Show loading state
            const originalText = this.innerHTML;
            this.disabled = true;
            this.innerHTML =
              '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Connecting...';

            // Simulate OAuth redirect (replace with actual OAuth flow in production)
            setTimeout(() => {
              window.location.href = "/api/auth/google";
            }, 1000);
          });
        }

        const facebookSignupBtn = document.getElementById("facebook-signup");
        if (facebookSignupBtn) {
          facebookSignupBtn.addEventListener("click", function () {
            // Show loading state
            const originalText = this.innerHTML;
            this.disabled = true;
            this.innerHTML =
              '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Connecting...';

            // Simulate OAuth redirect (replace with actual OAuth flow in production)
            setTimeout(() => {
              window.location.href = "/api/auth/facebook";
            }, 1000);
          });
        }
      });
    </script>
  </body>
</html>
